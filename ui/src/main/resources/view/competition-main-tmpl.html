<!--
    Copyright (C) 2015-2016 Jari Ojala (jari.ojala@iki.fi).
-->

<div class="container">
    <form>
        <fieldset>
            <legend>
                <span class="span2">
                    <small>{{competition.time | date:"dd.M.yyyy HH.mm"}}</small>
                </span>
                <span>{{competition.name}}</span><br/>
                <span><small>{{competition.organizer}}</small></span>
<!-- TODO: Remove the following -->
<br/>
<span><small><time-editor basetime=0 ng-init="testTime='00:00:00.0'" ng-model="testTime"></time-editor></small></span>
<span><small>{{testTime}}</small></span>
<br>
<span><small><time-editor basetime=0 ng-model="testTime2"></time-editor></small></span>
<span><small>{{testTime2}}</small></span>
            </legend>
        </fieldset>
    </form>
    <div>
        <ul class="nav nav-tabs" ng-init="option = 1">
            <li ng-class="option == 1 ? 'active' : ''">
                <a href ng-click="option = 1">Competitors</a>
            </li>
            <li ng-class="option == 2 ? 'active' : ''">
                <a href ng-click="option = 2">Classes</a>
            </li>
            <li ng-class="option == 3 ? 'active' : ''">
                <a href ng-click="option = 3">Groups</a>
            </li>
        </ul>

        <div ng-show="option == 1">
            <label>
                Search filter:
                <input ng-model="competitor.filter">
            </label>

            <label>
                Sort by:
                <select ng-model="competitor.orderBy">
                    <option value="_ref.clazz">Class</option>
                    <option value="_ref.number">Number</option>
                    <option value="_ref.offset">Start time</option>
                    <option value="_ref.finish">Finish time</option>
                    <option value="_result">Result</option>
                    <option value="_ref.name">Name</option>
                </select>
            </label>

            <label>
                Pick next free number in the group
                <input type="checkbox" ng-model="competitor.autoNumbering">
            </label>
  
            <table class="table table-hover">
                <thead>
                    <tr>
                        <td>Class</td>
                        <td>Number</td>
                        <td>Start time</td>
                        <td class="glyphicon glyphicon-time"/>
                        <td>Finish time</td>
                        <td class="glyphicon glyphicon-time"/>
                        <td>Result</td>
                        <td>Name</td>
                        <td></td>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <input type="text"
                                   ng-model="current.competitor._clazz"
                                   uib-typeahead="c as c._ref.name for c in clazzes 
                                        | filter:{_ref:{name:$viewValue}}"
                                   placeholder="<competitor's class>">
                        </td>
                        <td>
                            <input type="text"
                                   placeholder="<competitor's number>"
                                   ng-model='current.competitor._ref.number'/>
                        </td>
                        <td>
                            <input type="text"
                                   placeholder="<competitor's start time>"
                                   ng-model='current.competitor._ref.offset'/>
                        </td>
                        <td class="glyphicon glyphicon-time"
                            ng-click="onCompetitorStart(current.competitor)"/>
                        <td>
                            <input type="text"
                                   placeholder="<competitor's finish time>"
                                   ng-model='current.competitor._ref.finish'/>
                        </td>
                        <td class="glyphicon glyphicon-time"
                            ng-click="onCompetitorFinish(current.competitor)"/>
                        <td/>
                        <td>
                            <input type="text"
                                   placeholder="<competitor's name>"
                                   ng-model='current.competitor._ref.name'/>
                        </td>
                        <td>
                            <a href ng-click="onCompetitorCreate(current.competitor)"
                                    data-toggle="tooltip" data-placement="left"
                                    title="Create new competitor with this data.">
                                <i class="glyphicon glyphicon-plus"></i>
                            </a>
                            <a href ng-show="current.competitor._ref['id']"
                                    ng-click="onCompetitorUpdate(current.competitor)"
                                    data-toggle="tooltip" data-placement="left"
                                    title="Update the competitor with this data.">
                                <i class="glyphicon glyphicon-edit"></i>
                            </a>
                        </td>
                    </tr>
                    <tr ng-repeat="c in competitors
                            | filter:competitor.filter
                            | orderBy:competitor.orderBy"
                        ng-click="onCompetitorSelect(c)">

                        <td>{{c._clazz._ref.name}}</td>
                        <td>{{c._ref.number}}</td>
                        <td>{{c._ref.offset}}</td>
                        <td/>
                        <td>{{c._ref.finish}}</td>
                        <td/>
                        <td>{{c._result | timestamp:'HH:mm:ss.sss'}}</td>
                        <td>{{c._ref.name}}</td>
                        <td>
                            <a href ng-click="onCompetitorDestroy(c, $index)"
                                    data-togglse="tooltip" data-placement="left"
                                    title="Permanently remove the competition.">
                                <i class="glyphicon glyphicon-remove-sign"></i>
                            </a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div ng-show="option == 2">
            <div>
                Search: <input ng-model="clazz.filter">

                Sort by:
                <select ng-model="clazz.sortCriteria">
                    <option value="name">Name</option>
                    <option value="offset">Offset</option>
                    <option value="group">Group</option>
                </select>
            </div>

            <table class="table table-hover">
                <thead>
                    <tr>
                        <td>Name</td>
                        <td>Offset</td>
                        <td class="glyphicon glyphicon-time"/>
                        <td>Group</td>
                        <td></td>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <input type='text'
                                   placeholder="<class name>"
                                   ng-model="current.clazz._ref.name"/>
                        </td>
                        <td>
                            <input type="text"
                                   placeholder="<class offset>"
                                   ng-model='current.clazz._ref.offset'/>
                        </td>
                        <td class="glyphicon glyphicon-time"
                            ng-click="onClazzStart(current.clazz)"/>
                        <td>
                            <input type="text"
                                   ng-model="current.clazz._group"
                                   uib-typeahead="g as (g.name) for g in groups  | filter:$viewValue"
                                   placeholder="<class's group>"/>
                        </td>
                        <td>
                            <a href ng-click="onClazzCreate(current.clazz)"
                                    data-toggle="tooltip" data-placement="left"
                                    title="Create new competitor with this data.">
                                <i class="glyphicon glyphicon-plus"></i>
                            </a>
                            <a href ng-show="current.clazz._ref['id']"
                                    ng-click="onClazzUpdate(current.clazz)"
                                    data-toggle="tooltip" data-placement="left"
                                    title="Update the class with this data.">
                                <i class="glyphicon glyphicon-edit"></i>
                            </a>
                        </td>
                    </tr>

                    <tr ng-repeat="c in clazzes | filter:clazz.filter
                            | orderBy:clazz.sortCriteria"
                        ng-click="onClazzSelect(c)">
                        <td>{{c._ref.name}}</td>
                        <td>{{c._ref.offset}}</td>
                        <td/>
                        <td>{{c._group.name}}</td>
                        <td>
                            <a href ng-click="onClazzDestroy(c)"
                                    data-togglse="tooltip" data-placement="left"
                                    title="Permanently remove the class.">
                                <i class="glyphicon glyphicon-remove-sign"></i>
                            </a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div ng-show="option == 3">
            <div>
                Search: <input ng-model="group.filter">

                Sort by:
                <select ng-model="group.sortCriteria">
                    <option value="name">Name</option>
                    <option value="minNumber">Min. number</option>
                    <option value="offset">Offset</option>
                </select>
            </div>
            <table class="table table-hover">
                <thead>
                    <tr>
                        <td>Name</td>
                        <td>Min. number</td>
                        <td>Offset</td>
                        <td class="glyphicon glyphicon-time"/>
                        <td></td>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <input type='text'
                                   placeholder="<group's name>"
                                   ng-model="current.group.name"/>
                        </td>
                        <td>
                            <input type="text"
                                   placeholder="<grou's min. number>"
                                   ng-model='current.group.minNumber'/>
                        </td>
                        <td>
                            <input type="text"
                                   placeholder="<group's offset>"
                                   ng-model='current.group.offset'/>
                        </td>
                        <td class="glyphicon glyphicon-time"
                            ng-click="onGroupStart(current.group)"/>
                        <td>
                            <a href ng-click="onGroupCreate(current.group); 
                                            current.group = {}"
                                    data-toggle="tooltip" data-placement="left"
                                    title="Create new group with this data.">
                                <i class="glyphicon glyphicon-plus"></i>
                            </a>
                            <a href ng-show="current.group['id']"
                                    ng-click="onGroupUpdate(current.group)"
                                    data-toggle="tooltip" data-placement="left"
                                    title="Update the group with this data.">
                                <i class="glyphicon glyphicon-edit"></i>
                            </a>
                        </td>
                    </tr>
                    <tr ng-repeat="g in groups | filter:group.filter 
                            | orderBy:group.sortCriteria"
                        ng-click="onGroupSelect(g)">
                        <td>{{g.name}}</td>
                        <td>{{g.minNumber}}</td>
                        <td>{{g.offset}}</td>
                        <td/>
                        <td>
                            <a href ng-click="onGroupDestroy(g, $index)"
                                    data-togglse="tooltip" data-placement="left"
                                    title="Permanently remove the group.">
                                <i class="glyphicon glyphicon-remove-sign"></i>
                            </a>
                        </td>
                    </tr>
                </tbody>
            </table>            
        </div>
    </div>
</div>

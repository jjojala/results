#!/bin/sh

app=$0
url=http://localhost:8800/rest

usage() {
cat -<<EOF
Usage: $app -h|{-k <key> {-I <file>|-E} }
Options:
  -h          this help
  -k <key>    object's identity
  -I <file>   import competition with id=<key> in <file>
  -E          export competition with id=<key>
  -D          delete competition with id=<key>
EOF
}

# doDelete(<key>)
doDelete() {
	exec curl -X DELETE ${url}/competition/${1}
}

# doImport(<file>, <key>)
doImport() {
	exec curl -X POST -H 'Content-Type: application/xml' \
		-d @${1} ${url}/competition/import/${2}
}

# doExport(<key>)
doExport() {
	exec curl -X GET -H 'Accept: application/xml' \
		${url}/competition/export/${1}
}

while getopts "DI:Ek:h" arg; do
	case $arg in
	h) usage ; exit 0 ;;
	k) key=$OPTARG ;;
	D) doDelete $key ; exit $? ;;
	I) doImport $OPTARG $key ; exit $? ;;
	E) doExport $key ; exit $? ;;
	esac
done

